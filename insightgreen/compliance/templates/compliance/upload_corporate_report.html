{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="content">


    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-icon-start alert-dismissible fade show">
                <span class="alert-icon bg-{{ message.tags }} text-white">
                    <i class="ph-bell-ringing"></i>
                </span>
                <span class="fw-semibold">{{ message }}</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    </div>
{% endif %}





    <div class="row">
        <!-- ESG Compliance Form -->
<div class="col-lg-8">
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">ESG Corporate Report Submission</h5>
        </div>

        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <div class="mb-3">
                    <label class="form-label" for="report_file">Attach Corporate Report</label>
                    <input type="file" class="form-control" name="report_file" id="report_file" required>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="document_title">ESG Report Title</label>
                    <input type="text" class="form-control" name="document_title" placeholder="e.g. Annual Report 2024" required value="">
                </div>

                <div class="mb-3">
                    <label class="form-label" for="organization_name">Company Name</label>
                    <select class="form-select" name="organization_name" required>
                        {% for value, label in form.organization_name.field.choices %}
                            <option value="{{ value }}" {% if form.organization_name.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="industry_sector">Industry / Sector</label>
                    <select class="form-select" name="industry_sector" required>
                        {% for value, label in form.industry_sector.field.choices %}
                            <option value="{{ value }}" {% if form.industry_sector.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>


                <div class="mb-3">
                    <label class="form-label" for="organization_type">Organization Type</label>
                    <select class="form-select" name="organization_type" required>
                        {% for value, label in form.organization_type.field.choices %}
                            <option value="{{ value }}" {% if form.organization_type.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="country_region">Country / Region</label>
                    <select class="form-select" name="country_region" required>
                        {% for value, label in form.country_region.field.choices %}
                            <option value="{{ value }}" {% if form.country_region.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="reporting_year">Reporting Year</label>
                    <select class="form-select" name="reporting_year" required>
                        {% for value, label in form.reporting_year.field.choices %}
                            <option value="{{ value }}" {% if form.reporting_year.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="reporting_period">Reporting Period</label>
                    <select class="form-select" name="reporting_period" required>
                        {% for value, label in form.reporting_period.field.choices %}
                            <option value="{{ value }}" {% if form.reporting_period.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="standards_applied">Standards Applied</label>

                    <select class="form-control multiselect" multiple="multiple" data-include-select-all-option="true" data-enable-filtering="true" data-enable-case-insensitive-filtering="true" name="standards_applied" required>
                        {% for value, label in form.standards_applied.field.choices %}
                            <option value="{{ value }}" {% if value in form.standards_applied.value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="report_type">Reporting Frequency</label>
                    <select class="form-select" name="report_type" required>
                        {% for value, label in form.report_type.field.choices %}
                            <option value="{{ value }}" {% if form.report_type.value == value %} selected {% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="is_peer_report">Is Peer Report</label>
                    <select class="form-select" name="is_peer_report" required>
                        <option value="">Select an option</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="is_confidential">Is Confidential</label>
                    <select class="form-select" name="is_confidential" required>
                        <option value="">Select an option</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label" for="peer_group_name">Peer Group Name</label>
                    <input type="text" class="form-control" name="peer_group_name" placeholder="e.g. JSE Top 40" value="">
                </div>

                <div class="card-footer d-flex justify-content-end p-0 pt-3">
                    <button type="submit" class="btn btn-primary">
                        Submit Corporate Report <i class="ph-paper-plane-tilt ms-2"></i>
                    </button>
                </div>
            
                
            </form>
            
        </div>
    </div>
</div>
<!-- /ESG Compliance Form -->


        <!-- Document Preview -->
<div class="col-lg-4">
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">ESG Standard Document Preview</h5>
        </div>
        <div class="card-body">
            <p class="text-muted">Uploaded document preview will appear here. You can review the contents before final submission.</p>
            <div class="border p-3">
                <!-- Initially show this message if no file is uploaded -->
                <p class="text-center text-muted mb-0" id="preview-message">No document uploaded yet. Please attach a report to see the preview.</p>

                <!-- Document Preview Area -->
                <div id="document-preview" class="text-center">
                    <!-- Here the preview will be inserted dynamically based on the file type -->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Document Preview -->

<script>
    // Preview document on file selection
    document.getElementById('report_file').addEventListener('change', function(e) {
        var file = e.target.files[0];
        var previewArea = document.getElementById('document-preview');
        var messageArea = document.getElementById('preview-message');
        
        if (file) {
            messageArea.style.display = 'none';  // Hide the 'no file uploaded' message

            var fileReader = new FileReader();
            
            // If file is an image (e.g., PNG, JPEG, etc.)
            if (file.type.startsWith('image/')) {
                fileReader.onload = function(event) {
                    var img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '800px';
                    previewArea.innerHTML = '';  // Clear the previous preview
                    previewArea.appendChild(img);
                };
            }
            // If file is a PDF
            else if (file.type === 'application/pdf') {
                fileReader.onload = function(event) {
                    var pdfEmbed = document.createElement('embed');
                    pdfEmbed.src = event.target.result;
                    pdfEmbed.width = '100%';
                    pdfEmbed.height = '1000px';
                    pdfEmbed.type = 'application/pdf';
                    previewArea.innerHTML = '';  // Clear the previous preview
                    previewArea.appendChild(pdfEmbed);
                };
            }
            // Add more file types (e.g., Word, Excel) as needed

            fileReader.readAsDataURL(file);  // Read the file content as data URL
        } else {
            messageArea.style.display = 'block';  // Show the 'no file uploaded' message
            previewArea.innerHTML = '';  // Clear the preview area
        }
    });
</script>

    </div>
</div>

{% endblock %}













